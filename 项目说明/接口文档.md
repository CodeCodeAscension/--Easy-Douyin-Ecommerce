# 接口文档

在此处定义各个微服务Controller类对外提供的接口，各个微服务应该按照本文档的定义来写。

如果有需要修改某个接口信息，请与其他可能需要使用该接口的人员协商一致，然后修改本文档。（如果没有严重的问题，不要去修改远程调用的服务接口）

所有接口的返回值都应该是``com.example.common.domain.ResponseResult``对象，其中``code``属性的值应为``com.example.common.domain.ResultCode``的定义。

即所有的接口响应参数为：

|  参数名称  |       参数说明       |    类型     |
|:------:|:----------------:|:---------:|
|  code  |     接口返回状态码      |  Integer  |
|  data  |  接口返回的数据，可为null  |  Object   |
|  msg   |  接口返回的信息，可为null  |  String   |

接口无需手动解析token。在网关处会解析请求头自带的token，并将获取到的用户ID设置到请求头`X-User-Id`中，各个微服务在`ecommerce-common`模块已经配置了相同的拦截器，用于解析请求头`X-User-Id`的数据，存放到线程上下文`com.example.common.utl.UserContextUtil`中。Feign调用远程服务的时候也会自动设置这个请求头。

经过网关测试需要用户登录的接口，请求头设置`Authorization`字段，不经过网关直接测试微服务接口，请求头设置`X-User-Id`字段。

接口有`可选`、`高级`、`需要用户登录`这三种说明，没有出现说明则默认为`必选`和`不需要用户登录`。

## 一、用户服务

### 1、登录

**接口地址**：`/api/v1/user/login`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody LoginDto`

|   参数名称   |   参数说明    |     传参位置     | 是否必须 |   数据类型   |
|:--------:|:---------:|:------------:|:----:|:--------:| 
| loginDto | 传递用户登录的信息 | @RequestBody | true | LoginDto | 
|  email   | 用户注册时的邮箱  |   loginDto   | true |  String  |
| password |   用户密码    |   loginDto   | true |  String  |

**返回对象**：`ResponseResult<LoginVo>`，其中`data`字段的定义为：

|     参数名称     |  参数说明  |  数据类型  |
|:------------:|:------:|:------:|
|    userId    |  用户ID  |  Long  |
| accessToken  | 用户访问令牌 | String |
| refreshToken | 用户刷新令牌 | String |

## 2、注册

**接口地址**：`/api/v1/user/register`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody RegisterDto`

|      参数名称       |   参数说明    |     传参位置     | 是否必须 |    数据类型     |
|:---------------:|:---------:|:------------:|:----:|:-----------:| 
|   registerDto   | 传递用户注册的信息 | @RequestBody | true | RegisterDto |
|      email      |  用户电子邮件   | registerDto  | true |   String    |
|    password     |   用户密码    | registerDto  | true |   String    |
| confirmPassword | 用户再次确认的密码 | registerDto  | true |   String    |

**返回对象**：`ResponseResult<RegisterVo>`，其中`data`字段的定义为：

|  参数名称  | 参数说明  |  数据类型  |
|:------:|:-----:|:------:|
| userId | 新用户ID |  Long  |

## 3、用户登出

`可选`，`需要用户登录`

**接口地址**：`/api/v1/user/logout`

**请求方式**：`POST`

**请求参数**：`无`

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

## 4、删除用户

`可选`，`需要用户登录`

**接口地址**：`/api/v1/users`

**请求方式**：`DELETE`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody LogoffDto`

|   参数名称    |      参数说明      |     传参位置     | 是否必须  |   数据类型    |
|:---------:|:--------------:|:------------:|:-----:|:---------:| 
| logoffDto |   传递用户注销的信息    | @RequestBody | true  | LogoffDto |
|  status   | 注销或者封禁（1封禁2注销） |  logoffDto   | true  |  Integer  |
|  reason   |    注销或封禁原因     |  logoffDto   | false |  String   |

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

## 5、更新用户

`可选`，`需要用户登录`

**接口地址**：`/api/v1/users`

**请求方式**：`PUT`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody UserUpdateDto`

|     参数名称      |   参数说明    |     传参位置      | 是否必须  |     数据类型      |
|:-------------:|:---------:|:-------------:|:-----:|:-------------:| 
| userUpdateDto | 传递用户更新的信息 | @RequestBody  | true  | UserUpdateDto |
|   userName    |    用户名    | userUpdateDto | false |    String     |
|     phone     |    手机号    | userUpdateDto | false |    String     |
|     city      |   所在城市    | userUpdateDto | false |    String     |
|   province    |   所在省份    | userUpdateDto | false |    String     |
|    country    |   所在国家    | userUpdateDto | false |    String     |
|    zipCode    |   邮政编码    | userUpdateDto | false |    String     |
| userCurrency  |  用户使用的货币  | userUpdateDto | false |    String     |

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

## 6、获取用户身份信息

`需要用户登录`

**接口地址**：`/api/v1/users`

**请求方式**：`GET`

**请求参数**：`无`

**返回对象**：`ResponseResult<UserInfoVo>`，其中`data`字段的定义为：

|     参数名称      |      参数说明       |     数据类型      |
|:-------------:|:---------------:|:-------------:|
|    userId     |      用户ID       |     Long      |
|     email     |      邮箱地址       |    String     |
|   userName    |       用户名       |    String     |
|     phone     |       手机号       |    String     |
|     city      |      所在城市       |    String     |
|   province    |      所在省份       |    String     |
|    country    |      所在国家       |    String     |
|    zipCode    |      邮政编码       |    String     |
| userCurrency  |     用户使用的货币     |    String     |
|    status     | 状态（0正常，1封禁，2注销） |    Integer    |
| disableReason |     注销或封禁原因     |    String     |
|  createTime   |      创建时间       | LocalDateTime |
|  updateTime   |      修改时间       | LocalDateTime |

### 7、续期令牌

`高级`

**接口地址**：`/api/v1/user/refresh`

**请求方式**：`PUT`

**请求参数**：`@RequestHeader("Refresh-Token")`

**返回对象**：`ResponseResult<LoginVo>`

## 二、商品服务

### 1、创建商品

`可选`，`需要用户登录`

**接口地址**：`/api/v1/products`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody CreateProductDto`

|       参数名称       |    参数说明     |       传参位置       | 是否必须  |       数据类型       |
|:----------------:|:-----------:|:----------------:|:-----:|:----------------:| 
| createProductDto |   创建的商品信息   |   @RequestBody   | true  | CreateProductDto | 
|       name       |    商品名称     | createProductDto | true  |      String      |
|   description    |    商品描述     | createProductDto | true  |      String      |
|      price       |    商品价格     | createProductDto | true  |      Float       |
|       sold       |    商品销量     | createProductDto | false |     Integer      |
|   merchantName   |    商家名称     | createProductDto | true  |      String      |
|    categories    |    所属类别     | createProductDto | true  |  `List<String>`  |
|      status      | 状态（0上架，1下架） | createProductDto | false |     Integer      |

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

### 2、修改商品信息

`可选`，`需要用户登录`

**接口地址**：`/api/v1/products`

**请求方式**：`PUT`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody UpdateProductDto`

|       参数名称       |    参数说明     |       传参位置       | 是否必须  |       数据类型       |
|:----------------:|:-----------:|:----------------:|:-----:|:----------------:| 
| updateProductDto |   创建的商品信息   |   @RequestBody   | true  | UpdateProductDto | 
|        id        |    商品ID     | updateProductDto | true  |       Long       |
|       name       |    商品名称     | updateProductDto | false |      String      |
|   description    |    商品描述     | updateProductDto | false |      String      |
|      price       |    商品价格     | updateProductDto | false |      Float       |
|       sold       |    商品销量     | updateProductDto | false |     Integer      |
|      stoke       |    商品库存     | updateProductDto | false |     Integer      |
|   merchantName   |    商家名称     | updateProductDto | false |      String      |
|    categories    |    所属类别     | updateProductDto | false |  `List<String>`  |
|      status      | 状态（0上架，1下架） | updateProductDto | false |     Integer      |

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

#### 2.1 增加库存

`需要用户登录`

**接口地址**：`/api/v1/products`

**请求方式**：`PUT`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody AddProductDto`

|     参数名称      |  参数说明   |     传参位置      | 是否必须 |     数据类型      |
|:-------------:|:-------:|:-------------:|:----:|:-------------:| 
| addProductDto | 创建的商品信息 | @RequestBody  | true | AddProductDto | 
|      id       |  商品ID   | addProductDto | true |     Long      |
|   addStoke    | 增加的库存数量 | addProductDto | true |    Integer    |


**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

#### 2.1 增加库存

`需要用户登录`

**接口地址**：`/api/v1/products/add`

**请求方式**：`PUT`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody AddProductDto`

|     参数名称      |  参数说明   |     传参位置      | 是否必须 |     数据类型      |
|:-------------:|:-------:|:-------------:|:----:|:-------------:| 
| addProductDto | 创建的商品信息 | @RequestBody  | true | AddProductDto | 
|   productId   |  商品ID   | addProductDto | true |     Long      |
|   addStock    | 增加的库存数量 | addProductDto | true |    Integer    |


**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

#### 2.2 减少库存

`内部`（该接口地址不会暴露在网关的匹配路由）

**接口地址**：`/api/v1/inner/products/dec`

**请求方式**：`PUT`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody DecProductDto`

|     参数名称      |  参数说明   |     传参位置      | 是否必须 |     数据类型      |
|:-------------:|:-------:|:-------------:|:----:|:-------------:| 
| decProductDto | 创建的商品信息 | @RequestBody  | true | DecProductDto | 
|   productId   |  商品ID   | decProductDto | true |     Long      |
|   decStock    | 增加的库存数量 | decProductDto | true |    Integer    |


**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

### 3、删除商品

`可选`，`需要用户登录`

**接口地址**：`/api/v1/products/{productId}`

**请求方式**：`DELETE`

**请求参数**：`@RequestParam productId`

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

### 4、查询单条商品信息

**接口地址**：`/api/v1/products/{productId}`

**请求方式**：`GET`

**请求参数**：`@PathVariable productId`

**返回对象**：`ResponseResult<ProductInfoVo>`，其中`data`字段的定义为：

|     参数名称     |    参数说明     |      数据类型      |
|:------------:|:-----------:|:--------------:|
|      id      |    商品ID     |      Long      |
|     name     |    商品名称     |     String     |
| description  |    商品描述     |     String     |
|    price     |    商品价格     |     Float      |
|     sold     |    商品销量     |    Integer     |
|    stoke     |    商品库存     |    Integer     |
| merchantName |    商家名称     |     String     |
|  categories  |    所属类别     | `List<String>` |
|    status    | 状态（0上架，1下架） |    Integer     |
|  createTime  |    创建时间     | LocalDateTime  |
|  updateTime  |    修改时间     | LocalDateTime  |

### 5、指定某种类别查询商品信息

**接口地址**：`/api/v1/products`

**请求方式**：`GET`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody ListProductsDto`

|      参数名称       |     参数说明     |      传参位置       | 是否必须  |      数据类型       |
|:---------------:|:------------:|:---------------:|:-----:|:---------------:| 
| listProductsDto |    显示商品信息    |  @RequestBody   | true  | ListProductsDto |
|      page       |  第几页（默认第一页）  | listProductsDto | false |     Integer     |
|    pageSize     |  页数大小（默认20）  | listProductsDto | false |     Integer     |
|  categoryName   | 类型名称（默认Null） | listProductsDto | false |     String      |

**返回对象**：`ResponseResult<IPage<ProductInfoVo>>`

### 6、指定条件查询商品信息

**接口地址**：`/api/v1/products/search`

**请求方式**：`GET`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody SearchProductsDto`

|       参数名称        |     参数说明     |       传参位置        | 是否必须  |       数据类型        |
|:-----------------:|:------------:|:-----------------:|:-----:|:-----------------:| 
| searchProductsDto |    查询商品信息    |   @RequestBody    | true  | SearchProductsDto |
|       page        |  第几页（默认第一页）  | searchProductsDto | false |      Integer      |
|     pageSize      |  页数大小（默认20）  | searchProductsDto | false |      Integer      |
|    productName    |     商品名称     | searchProductsDto | false |      String       |
|     priceLow      |     最低价格     | searchProductsDto | false |       Float       |
|     priceHigh     |     最高价格     | searchProductsDto | false |       Float       |
|       stoke       |      销量      | searchProductsDto | false |      Integer      |
|       sold        |      库存      | searchProductsDto | false |      Integer      |
|   merchantName    | 商家名称（默认Null） | searchProductsDto | false |      String       |
|   categoryName    | 类型名称（默认Null） | searchProductsDto | false |      String       |

**返回对象**：`ResponseResult<IPage<ProductInfoVo>>`

## 三、购物车服务

### 1、向购物车中添加商品

`需要用户登录`

**接口地址**：`/api/v1/carts`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody AddItemDto`

|    参数名称    |  参数说明   |     传参位置     | 是否必须 |    数据类型    |
|:----------:|:-------:|:------------:|:----:|:----------:| 
| addItemDto | 添加购物车商品 | @RequestBody | true | AddItemDto |
| productId  |  商品ID   |  addItemDto  | true |    Long    |
|  quantity  |  商品数量   |  addItemDto  | true |  Integer   |

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

### 2、清空购物车

`需要用户登录`

**接口地址**：`/api/v1/carts`

**请求方式**：`DELETE`

**请求参数**：`无`

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

### 3、获取购物车信息

`需要用户登录`

**接口地址**：`/api/v1/carts`

**请求方式**：`GET`

**请求参数**：`无`

**返回对象**：`ResponseResult<CartInfoVo>`，其中`data`字段的定义为：

|    参数名称    |        参数说明        |         数据类型         |
|:----------:|:------------------:|:--------------------:|
|     id     |       购物车ID        |         Long         |
|   userId   |        用户ID        |         Long         |
|   status   | 状态（0待支付，1已支付，2已删除） |       Integer        |
| cartItems  |     购物车所有商品信息      | `List<CartItemInfo>` |
| createTime |        创建时间        |    LocalDateTime     |
| updateTime |        修改时间        |    LocalDateTime     |

其中`CartItemInfo`的定义为：

|    参数名称    |        参数说明        |     数据类型      |
|:----------:|:------------------:|:-------------:|
|     id     |       购物车ID        |     Long      |
| productId  |        商品ID        |     Long      |
|  quantity  |        商品数量        |    Integer    |
|   status   | 状态（0待支付，1已支付，2已删除） |    Integer    |
| createTime |        创建时间        | LocalDateTime |
| updateTime |        修改时间        | LocalDateTime |

## 四、订单服务

### 0、Address类的CRUD操作

`需要用户登录`

**接口地址**：`/api/v1/orders/addresses`

`Address`实体类可以直接看数据库，对该表进行单表的增删查改即可，由于本接口不需要被其他服务调用，dto和vo的定义自己编写即可。

需要注意的是，`fegin-api`模块给出的`Address`实体类的定义并不完全，该类仅用于微服务间调用使用。

### 1、创建订单

`需要用户登录`

**接口地址**：`/api/v1/orders`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody PlaceOrderDto`

（注意有自定义的数据类型的嵌套）

|     参数名称      |     参数说明     |     传参位置      | 是否必须  |       数据类型       |
|:-------------:|:------------:|:-------------:|:-----:|:----------------:| 
| placeOrderDto |    创建订单信息    | @RequestBody  | true  |  PlaceOrderDto   |
| userCurrency  |   用户使用的货币    | placeOrderDto | true  |      String      |
|    address    |    用户收获地址    | placeOrderDto | true  |     Address      |
| streetAddress |     街道地址     |    address    | true  |      String      |
|     city      |      城市      |    address    | true  |      String      |
|   province    |      省份      |    address    | true  |      String      |
|    country    |      国家      |    address    | true  |      String      |
|    zipCode    |     邮政编码     |    address    | true  |      String      |
|     email     |     用户邮箱     | placeOrderDto | false |      String      |
|   cartItems   |  要结算的购物车商品   | placeOrderDto | true  | `List<CartItem>` |
|   productId   |     商品ID     |   cartItem    | true  |       Long       |
|   quantity    | 商品数量cartItem |   cartItem    | true  |     Integer      |


**返回对象**：`ResponseResult<PlaceOrderVo>`，其中`data`字段的定义为：

|  参数名称   |  参数说明   |  数据类型  |
|:-------:|:-------:|:------:|
| orderId | 创建的订单ID | String |

### 2、修改订单信息

`可选`，`需要用户登录`

**接口地址**：`/api/v1/orders`

**请求方式**：`PUT`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody UpdateOrderDto`

（注意有自定义的数据类型的嵌套）

|      参数名称      |             参数说明             |      传参位置      | 是否必须  |       数据类型       |
|:--------------:|:----------------------------:|:--------------:|:-----:|:----------------:| 
| updateOrderDto |            修改订单信息            |  @RequestBody  | true  |  UpdateOrderDto  |
|    orderId     |             订单ID             | updateOrderDto | true  |      String      |
|     status     | 支付状态（0待确认，1已确认待支付，2已支付，3已取消） | updateOrderDto | true  |     Integer      |
|  userCurrency  |           用户使用的货币            | updateOrderDto | false |      String      |
|    address     |            用户收获地址            | updateOrderDto | false |     Address      |
| streetAddress  |             街道地址             |    address     | false |      String      |
|      city      |              城市              |    address     | false |      String      |
|    province    |              省份              |    address     | false |      String      |
|    country     |              国家              |    address     | false |      String      |
|    zipCode     |             邮政编码             |    address     | false |      String      |
|     email      |             用户邮箱             | updateOrderDto | false |      String      |
|    cartItem    |          要结算的购物车商品           | updateOrderDto | false | `List<CartItem>` |
|   productId    |             商品ID             |    cartItem    | true  |       Long       |
|    quantity    |         商品数量cartItem         |    cartItem    | true  |     Integer      |

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功


### 4、查看用户订单

`需要用户登录`

**接口地址**：`/api/v1/orders`

**请求方式**：`GET`

**请求参数**：`@RequestParam Integer pageSize, @RequestParam Integer PageNum`

**返回对象**：`ResponseResult<IPage<OrderInfoVo>>`，其中`data`中每一个`OrderInfoVo`字段的定义为：

|         参数名称          |                参数说明                |       数据类型       |
|:---------------------:|:----------------------------------:|:----------------:|
|        orderId        |                订单ID                |      String      |
|        status         | 支付状态（0待支付，1已确认待支付，2已支付，3支付失败，4已取消） |     Integer      |
|     userCurrency      |              用户使用的货币               |      String      |
|        address        |               用户收获地址               |     Address      |
| address.streetAddress |                街道地址                |      String      |
|     address.city      |                 城市                 |      String      |
|   address.province    |                 省份                 |      String      |
|    address.country    |                 国家                 |      String      |
|    address.zipCode    |                邮政编码                |      String      |
|         email         |                用户邮箱                |      String      |
|       cartItem        |             要结算的购物车商品              | `List<CartItem>` |
|  cartItem.productId   |                商品ID                |       Long       |
|   cartItem.quantity   |            商品数量cartItem            |     Integer      |
|      createTime       |                创建时间                |  LocalDateTime   |
|        payTime        |                支付时间                |  LocalDateTime   |
|      updateTime       |                修改时间                |  LocalDateTime   |

### 5、通过orderId查询某用于订单信息

`需要用户登录`

**接口地址**：`/api/v1/orders/{orderId}`

**请求方式**：`GET`

**请求参数**：`@PathVariable orderId`

**返回对象**：`ResponseResult<OrderInfoVo>`



### 6、根据条件查询订单

`需要用户登录`

**接口地址**：`/api/v1/orders/search`

**请求方式**：`GET`

**请求参数**：`@RequestParam Integer pageSize, @RequestParam Integer PageNum @RequestBody SearchOrderDto seatchOrderDto`

|         参数名称          |          参数说明           |      传参位置      | 是否必须  |      数据类型      |
|:---------------------:|:-----------------------:|:--------------:|:-----:|:--------------:| 
|    searchOrderDto     |          查询信息           |  @RequestBody  | true  | SearchOrderDto |
| paymentDateUpperBound |       支付时间上界（包含）        | searchOrderDto | false |      Date      |
| paymentDateLowerBound |       支付时间下界（包含）        | searchOrderDto | false |      Date      |
| createDateUpperBound  |       创建时间上界（包含）        | searchOrderDto | false |      Date      |
| createDateLowerBound  |       创建时间下界（包含）        | searchOrderDto | false |      Date      |
|        status         | 订单状态（见OrderStatus枚举类定义） | searchOrderDto | false |  OrderStatus   |


**返回对象**：`ResponseResult<IPage<OrderInfoVo>>`

## 五、结算服务

### 1、订单结算

（类似于自动免密支付的过程）

`需要用户登录`

**接口地址**：`/api/v1/checkout`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody CheckoutDto`

|     参数名称      |        参数说明        |     传参位置     | 是否必须  |     数据类型      |
|:-------------:|:------------------:|:------------:|:-----:|:-------------:| 
|  checkoutDto  |       订单结算信息       | @RequestBody | true  |  CheckoutDto  |
|    cartId     |       购物车ID        | checkoutDto  | true  |    Integer    |
|   firstName   |        用户名字        | checkoutDto  | false |    String     |
|   lastName    |        用户姓氏        | checkoutDto  | false |    String     |
| placeOrderDto | 创建订单的信息（见`创建订单`接口） | checkoutDto  | true  | PlaceOrderDto |
|   creditId    |       银行卡ID        | checkoutDto  | true  |    String     |

**返回对象**：`ResponseResult<CheckoutVo>`，当`code`字段为`200`时，其中`data`字段的定义为：

|     参数名称      | 参数说明 |  数据类型  |
|:-------------:|:----:|:------:|
|    orderId    | 订单ID | String |
| transactionId | 交易ID | String |

## 六、支付服务

### 0、对credit表的CRUD

由于本接口不需要被其他服务调用，dto和vo的定义自己编写即可。

`需要用户登录`

**接口地址**：`/api/v1/payments/credits`

### 1、支付

`需要用户登录`

**接口地址**：`/api/v1/payments`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody ChargeDto`

|   参数名称    |  参数说明  |     传参位置     | 是否必须 |   数据类型    |
|:---------:|:------:|:------------:|:----:|:---------:| 
| chargeDto | 订单支付信息 | @RequestBody | true | ChargeDto |
|  orderId  |  订单ID  |  chargeDto   | true |  String   |
| creditId  | 银行卡ID  |  chargeDto   | true |  String   |


**返回对象**：`ResponseResult<ChargeVo>`，其中`data`字段的定义为：

|       参数名称       | 参数说明  |  数据类型  |
|:----------------:|:-----:|:------:|
| preTransactionId | 预交易ID | String |

#### 1.1 获取交易信息

**接口地址**：`/api/v1/payments`

**请求方式**：`GET`

**请求参数**：`@RequestBody TransactionInfoDto`

|       参数名称       | 参数说明  | 传参位置 | 是否必须  |  数据类型  |
|:----------------:|:-----:|:----:|:-----:|:------:| 
|  TransactionId   | 交易ID  | dto  | false | String |
| preTransactionId | 预交易ID | dto  | false | String |

交易ID和预交易ID在数据库中都是唯一的，因此查询交易信息的时候可以使用其中任何一个，但必须提供一个。

**返回对象**：`ResponseResult<TransactionInfoVo>`，其中`data`字段的定义为：

|       参数名称       |           参数说明            |     数据类型      |
|:----------------:|:-------------------------:|:-------------:|
|  transactionId   |           交易ID            |    String     |
| preTransactionId |           预交易ID           |    String     |
|     orderId      |           订单ID            |    String     |
|     creditId     |           银行卡ID           |    String     |
|      amount      |            金额             |     Float     |
|      status      | 状态（0待确认，1支付成功，2支付失败，3已取消） |    Integer    |
|      reason      |           失败原因            |    String     |
|    createTime    |           创建时间            | LocalDataTime |
|    updateTime    |           更新时间            | LocalDataTime |

### 2、取消支付

`高级`，`需要用户登录`

**接口地址**：`/api/v1/payments`

**请求方式**：`DELETE`

**请求参数**：`@RequestParam preTransactionId`

**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

### 3、定时取消支付

`高级`，`需要用户登录`

**接口地址**：`/api/v1/payments`

**请求方式**：`PUT`

**请求参数**：`@RequestBody ChargeCancelDto`

|        参数名称        |         参数说明         |      传参位置       | 是否必须 |      数据类型       |
|:------------------:|:--------------------:|:---------------:|:----:|:---------------:| 
|  chargeCancelDto   |       交易定时取消信息       |  @RequestBody   | true | ChargeCancelDto |
|  preTransactionId  |        预交易ID         | chargeCancelDto | true |     String      |
|       status       | 是否设置定时取消（可以取消上次的定时）  | chargeCancelDto | true |     Boolean     |
| cancelAfterMinutes | 交易过多少分钟后自动取消（0为立即取消） | chargeCancelDto | true |     Integer     |


**返回对象**：`ResponseResult<Null>`，使用`code`和`msg`字段标志是否成功

## 七、AI服务

### 1、智能订单查询

`高级`，`需要用户登录`

**接口地址**：`/api/v1/ai/orders/query`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody AiOrderQueryDto`

|      参数名称       |          参数说明          |       传参位置       |  是否必须   |      数据类型       |
|:---------------:|:----------------------:|:----------------:|:-------:|:---------------:| 
| aiOrderQueryDto |        订单定时取消信息        |   @RequestBody   |  true   | AiOrderQueryDto |
|  queryContent   |  	查询内容（自然语言文本）  | 	aiOrderQueryDto |  	true  |     	String     |
|   orderStatus   | 	订单状态（0待确认，1已确认待支付，2已支付，3已取消）	 | 	aiOrderQueryDto | 	false	 |     Integer     |
| maxResultCount  |     	最大返回结果数（默认10）     | 	aiOrderQueryDto | 	false	 |     Integer     |

**返回对象**：`ResponseResult<AiOrderQueryVo>`，其中`data`中字段的定义为：

|   参数名称    |        参数说明         |        数据类型        |
|:---------:|:-------------------:|:------------------:|
|  answer   | 	自然语言形式的查询结果（AI生成）	 |       String       |
| orderList |     	结构化订单数据列表      | 	List<OrderInfoVo> |

### 2、模拟自动下单

`高级`，`需要用户登录`

**接口地址**：`/api/v1/ai/orders/auto-place`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody AiPlaceOrderDto`

|      参数名称       |            参数说明             |      传参位置       |      是否必须      |      数据类型       |
|:---------------:|:---------------------------:|:---------------:|:--------------:|:---------------:| 
| aiPlaceOrderDto |          订单定时取消信息           |  @RequestBody   |      true      | AiPlaceOrderDto |
|   triggerType   | 根据自然语言指令要求 | aiPlaceOrderDto |      true      |     Integer     |
|     command     |           自然语言指令            | aiPlaceOrderDto | true |     Integer     |
|   confirmFlag   |         是否需要用户手动确认          | aiPlaceOrderDto |      true      |     Boolean     |

**返回对象**：`ResponseResult<AiPlaceOrderVo>`，其中`data`中字段的定义为：

|   参数名称    |     参数说明      |  数据类型  |
|:---------:|:-------------:|:------:|
|  orderList  | 需要确认时返回符合要求的订单,不需要确认时返回下单的订单列表 | ResponseResult<List<OrderInfoVo>> |


### 3、智能聊天助手

`高级`，`需要用户登录`

**接口地址**：`/api/v1/ai/chat/assistant`

**请求方式**：`POST`

**请求数据类型**：`application/json`

**请求参数**：`@RequestBody AiChatAssistantDto`

|      参数名称       |          参数说明          |       传参位置       |  是否必须   |      数据类型       |
|:---------------:|:----------------------:|:----------------:|:-------:|:---------------:| 
| aiChatAssistantDto |        聊天助手请求信息        |   @RequestBody   |  true   | AiChatAssistantDto |
|  chatContent   |  	聊天内容（自然语言文本）  | 	aiChatAssistantDto |  	true  |     	String     |
